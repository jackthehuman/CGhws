<!DOCTYPE html>
<html>
<head>
<style>
	body {
    background-color: #fff;
    color: #111;
    margin: 0px;
    overflow: hidden;
    font-family: Monospace;
    font-size: 10px;
    position: absolute;
    }
    #info {
        position: absolute;
        top: 0px;
        width: 100%;
        padding: 5px;
        text-align: center;
        color: #ffff00
    }
</style>
</head>

<body>
    <div id="info">hw5 helper</div>
    <script src="https://threejs.org/build/three.min.js"></script>
    <script src="https://threejs.org/examples/js/controls/OrbitControls.js">
    </script>
    <script src="http://jyunming-chen.github.io/tutsplus/js/KeyboardState.js"></script>
    <script src="https://raw.githack.com/mrdoob/three.js/dev/examples/js/geometries/TeapotGeometry.js"></script>
        
    
    <script id="myVertexShader" type="x-shader/x-vertex">
        uniform vec3 lightpos;  // world coordinate
        varying vec3 eyelightdir;
        varying vec3 eyenormal;   
        varying vec4 eyepos;
        
        void main() {
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    
            eyepos = modelViewMatrix * vec4 (position, 1.0);
            vec4 eyelightpos= viewMatrix * vec4 (lightpos, 1.0);
            eyelightdir =  eyelightpos.xyz - eyepos.xyz;
            eyenormal = normalMatrix * normal;
        }
    </script>
    <script id="myFragmentShader" type="x-shader/x-fragment">
        varying vec3 eyelightdir;
        varying vec3 eyenormal;
        varying vec4 eyepos;
        
        void main() {
            float intensity = dot (normalize (eyenormal), normalize (eyelightdir));         if (intensity > 0.8)
                intensity = 0.8;
            else if (intensity > 0.4)
                 intensity = 0.4;
            else
              intensity = 0.0;
            vec3 diffuse = intensity*vec3 (1,1,1);
        
            vec3 h = normalize(-normalize (eyepos.xyz) + normalize (eyelightdir));
            float shininess = 40.;    
            vec3 specular = pow (dot (eyenormal, h), shininess) *vec3 (1,0,0);
            //gl_FragColor = vec4(diffuse + specular, 1.0);
            gl_FragColor = vec4 (diffuse + vec3(0,0,0.13), 1.0);
        }
    </script>

<script>
var scene, renderer, camera;
var mesh, pointLight;
var keyboard = new KeyboardState();
var turn = true;
var angle = 0;

init();
animate();

function init() {
    var width = window.innerWidth;
    var height = window.innerHeight;

    renderer = new THREE.WebGLRenderer({
        antialias: true
    });
    renderer.setSize(width, height);
    document.body.appendChild(renderer.domElement);
    renderer.setClearColor(0x888888);

    scene = new THREE.Scene();

    camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 10000);
    camera.position.y = 160;
    camera.position.z = 400;

    let controls = new THREE.OrbitControls(camera, renderer.domElement);

    var gridXZ = new THREE.GridHelper(200, 20, 'red', 'white');
    scene.add(gridXZ);

    pointLight = new THREE.PointLight(0xffffff);
    scene.add (pointLight);
    scene.add (new THREE.PointLightHelper(pointLight, 5));

		var ambientLight = new THREE.AmbientLight(0x111111);
    scene.add(ambientLight);

 
    let meshMaterial = new THREE.ShaderMaterial({
        uniforms: {
        lightpos: {type: 'v3', value: new THREE.Vector3()}
        },
        vertexShader: document.getElementById('myVertexShader').textContent,
        fragmentShader: document.getElementById('myFragmentShader').textContent
    });

    
    //var geometry = new THREE.TorusKnotGeometry(20, 5, 100, 16);
    var geometry = new THREE.TeapotGeometry (30);
    mesh = new THREE.Mesh(geometry, meshMaterial);
    
    
    //mesh.position.set (70, 0, 50);
    //mesh.rotation.y = Math.PI/2;
    scene.add(mesh);
}

function animate() {
    keyboard.update();
    
    if (keyboard.down("Z")) turn = !turn;    
    if (turn) angle += 0.01;
    
    pointLight.position.set(50 * Math.cos(angle), 80, 50 * Math.sin(angle));    
    mesh.material.uniforms.lightpos.value.copy (pointLight.position);

    mesh.rotation.y = 1.3*angle;
    requestAnimationFrame(animate);
    render();
}

function render() {
    renderer.render(scene, camera);
}

</script>
</body>
</html>